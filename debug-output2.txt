
=====================================
 WSL DNS & MOTD Issues Diagnostic
=====================================

This script will investigate DNS resolution and 
login message issues in WSL instances.

Available WSL instances:
  - Ubuntu
  - Ubuntu-Minimal-ClaudeCode01
  - Ubuntu-24.04
  - Ubuntu-22.04

=== Debugging WSL Instance: Ubuntu-Minimal-ClaudeCode01 ===

Running diagnostic commands in WSL instance...
=== System Information === Hostname: Z4G4-OOTA2 OS: PRETTY_NAME="Ubuntu 22.04.5 LTS" Kernel: 6.6.87.1-microsoft-standard-WSL2  === DNS Configuration Debug === --- /etc/resolv.conf --- /etc/resolv.conf not found  --- /etc/wsl.conf --- [boot] systemd=true  --- systemd-resolved status --- 笳・systemd-resolved.service - Network Name Resolution      Loaded: loaded (/lib/systemd/system/systemd-resolved.service; enabled; vendor preset: enabled)      Active: active (running) since Mon 2025-06-23 19:51:16 JST; 2s ago        Docs: man:systemd-resolved.service(8)              man:org.freedesktop.resolve1(5)              https://www.freedesktop.org/wiki/Software/systemd/writing-network-configuration-managers              https://www.freedesktop.org/wiki/Software/systemd/writing-resolver-clients    Main PID: 101 (systemd-resolve)      Status: "Processing requests..."       Tasks: 1 (limit: 38336)      Memory: 10.2M         CPU: 100ms      CGroup: /system.slice/systemd-resolved.service              笏披楳101 /lib/systemd/systemd-resolved  Jun 23 19:51:15 Z4G4-OOTA2 systemd[1]: Starting Network Name Resolution... Jun 23 19:51:16 Z4G4-OOTA2 systemd-resolved[101]: Positive Trust Anchors: Jun 23 19:51:16 Z4G4-OOTA2 systemd-resolved[101]: . IN DS 20326 8 2 e06d44b80b8f1d39a95c0b0d7c65d08458e880409bbc683457104237c7f8ec8d Jun 23 19:51:16 Z4G4-OOTA2 systemd-resolved[101]: Negative trust anchors: home.arpa 10.in-addr.arpa 16.172.in-addr.arpa 17.172.in-addr.arpa 18.172.in-addr.arpa 19.172.in-addr.arpa 20.172.in-addr.arpa 21.172.in-addr.arpa 22.172.in-addr.arpa 23.172.in-addr.arpa 24.172.in-addr.arpa 25.172.in-addr.arpa 26.172.in-addr.arpa 27.172.in-addr.arpa 28.172.in-addr.arpa 29.172.in-addr.arpa 30.172.in-addr.arpa 31.172.in-addr.arpa 168.192.in-addr.arpa d.f.ip6.arpa corp home internal intranet lan local private test Jun 23 19:51:16 Z4G4-OOTA2 systemd-resolved[101]: Using system hostname 'Z4G4-OOTA2'. Jun 23 19:51:16 Z4G4-OOTA2 systemd[1]: Started Network Name Resolution.  --- DNS Resolution Test --- Testing with different methods: getent hosts google.com: FAILED nslookup google.com: FAILED host google.com: FAILED dig google.com: FAILED or dig not available  --- systemd-resolved resolve status --- Global        Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported resolv.conf mode: missing  Link 2 (eth0) Current Scopes: none      Protocols: -DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported  === MOTD/Login Message Debug === --- Checking MOTD files --- /etc/motd exists: NO /etc/motd content:  /etc/motd.dynamic exists: NO  --- /etc/update-motd.d directory --- Files in /etc/update-motd.d: total 40 drwxr-xr-x  2 root root 4096 Jan  7 06:37 . drwxr-xr-x 83 root root 4096 Jun 23 19:51 .. -rwxr-xr-x  1 root root 1220 Oct 15  2021 00-header -rwxr-xr-x  1 root root 1151 Sep 10  2024 10-help-text lrwxrwxrwx  1 root root   46 Jan  7 06:37 50-landscape-sysinfo -> /usr/share/landscape/landscape-sysinfo.wrapper -rwxr-xr-x  1 root root 5023 Oct 15  2021 50-motd-news -rwxr-xr-x  1 root root  296 Aug  8  2024 91-contract-ua-esm-status -rwxr-xr-x  1 root root  558 Jan 10  2023 91-release-upgrade -rwxr-xr-x  1 root root  165 Feb 19  2021 92-unattended-upgrades -rwxr-xr-x  1 root root  531 Sep 10  2024 99-wsl  Executable files: /etc/update-motd.d/50-motd-news /etc/update-motd.d/91-release-upgrade /etc/update-motd.d/10-help-text /etc/update-motd.d/91-contract-ua-esm-status /etc/update-motd.d/92-unattended-upgrades /etc/update-motd.d/00-header /etc/update-motd.d/99-wsl  --- .hushlogin files --- Root .hushlogin: MISSING WSL user .hushlogin: MISSING Skel .hushlogin: MISSING  --- PAM MOTD configuration --- PAM login motd config: 33:session    optional   pam_motd.so motd=/run/motd.dynamic 34:session    optional   pam_motd.so noupdate PAM sshd motd config: No pam_motd in sshd  --- MOTD news configuration --- /etc/default/motd-news: # Enable/disable the dynamic MOTD news service # This is a useful way to provide dynamic, informative # information pertinent to the users and administrators # of the local system ENABLED=1  # Configure the source of dynamic MOTD news # White space separated list of 0 to many news services # For security reasons, these must be https # and have a valid certificate # Canonical runs a service at motd.ubuntu.com, and you # can easily run one too URLS="https://motd.ubuntu.com"  # Specify the time in seconds, you're willing to wait for # dynamic MOTD news # Note that news messages are fetched in the background by # a systemd timer, so this should never block boot or login WAIT=5  --- systemd MOTD services --- motd-news.service status: 笳・motd-news.service - Message of the Day      Loaded: loaded (/lib/systemd/system/motd-news.service; static)      Active: inactive (dead) TriggeredBy: 笳・motd-news.timer        Docs: man:update-motd(8) Service not found motd-news.timer status: 笳・motd-news.timer - Message of the Day      Loaded: loaded (/lib/systemd/system/motd-news.timer; enabled; vendor preset: enabled)      Active: active (waiting) since Mon 2025-06-23 19:51:16 JST; 2s ago     Trigger: Mon 2025-06-23 21:17:54 JST; 1h 26min left    Triggers: 笳・motd-news.service  Jun 23 19:51:16 Z4G4-OOTA2 systemd[1]: Started Message of the Day.  --- Landscape configuration --- landscape-common package: Desired=Unknown/Install/Remove/Purge/Hold | Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend |/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad) ||/ Name             Version                Architecture Description +++-================-======================-============-===================================================== ii  landscape-common 23.02-0ubuntu1~22.04.3 amd64        Landscape administration system client - Common files landscape client config: File exists, content: [client] log_level = info url = https://landscape.canonical.com/message-system ping_url = http://landscape.canonical.com/ping data_path = /var/lib/landscape/client  --- Ubuntu advantage tools --- ubuntu-advantage-tools package: Desired=Unknown/Install/Remove/Purge/Hold | Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend |/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad) ||/ Name                   Version      Architecture Description +++-======================-============-============-================================================ ii  ubuntu-advantage-tools 34~22.04     all          transitional dummy package for ubuntu-pro-client  --- Legal file --- /etc/legal: File exists, content:  The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright.   === Network Interface Info === 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00     inet 127.0.0.1/8 scope host lo        valid_lft forever preferred_lft forever     inet 10.255.255.254/32 brd 10.255.255.254 scope global lo        valid_lft forever preferred_lft forever     inet6 ::1/128 scope host         valid_lft forever preferred_lft forever 2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000     link/ether 00:15:5d:a6:26:75 brd ff:ff:ff:ff:ff:ff     inet 172.22.27.184/20 brd 172.22.31.255 scope global eth0        valid_lft forever preferred_lft forever     inet6 fe80::215:5dff:fea6:2675/64 scope link         valid_lft forever preferred_lft forever  === Package Information === DNS-related packages: ii  bind9-dnsutils                1:9.18.30-0ubuntu0.22.04.2              amd64        Clients provided with BIND 9 ii  bind9-host                    1:9.18.30-0ubuntu0.22.04.2              amd64        DNS Lookup Utility ii  bind9-libs:amd64              1:9.18.30-0ubuntu0.22.04.2              amd64        Shared Libraries used by BIND 9  === Environment Variables === User: root Home: /root PWD: /mnt/c/work/ClaudeCode  === Debug Complete ===

Diagnostic complete. Please review the output above.

If you need to save this output to a file:
  .\Debug-WSLIssues.ps1 -InstanceName YourInstanceName > debug-output.txt
